#include "main.h"
#include "alcoi.hpp"

using namespace chibios_rt;
using namespace control;

/*
 ******************************************************************************
 * DEFINES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXTERNS
 ******************************************************************************
 */

/*
 ******************************************************************************
 * PROTOTYPES
 ******************************************************************************
 */

/*
 ******************************************************************************
 * GLOBAL VARIABLES
 ******************************************************************************
 */

/*
 ******************************************************************************
 ******************************************************************************
 * LOCAL FUNCTIONS
 ******************************************************************************
 ******************************************************************************
 */

/*
 ******************************************************************************
 * EXPORTED FUNCTIONS
 ******************************************************************************
 */
/**
 *
 */
void Alcoi::start(void) {
  ready = true;
}

/**
 *
 */
void Alcoi::stop(void) {
  ready = false;
}

/**
 *
 */
msg_t Alcoi::update(FutabaOutput &result, float dT) {
  (void)dT;

  osalDbgCheck(ready);

  result.ch[PID_CHAIN_AIL] = 0;
  result.ch[PID_CHAIN_ELE] = 0;
  result.ch[PID_CHAIN_RUD] = 0;
  result.ch[PID_CHAIN_THR] = 0;

  result.man = ManualSwitch::semiauto;

  result.ol[PID_CHAIN_AIL] = OverrideLevel::medium;
  result.ol[PID_CHAIN_ELE] = OverrideLevel::medium;
  result.ol[PID_CHAIN_RUD] = OverrideLevel::medium;
  result.ol[PID_CHAIN_THR] = OverrideLevel::medium;

  return MSG_OK;
}
